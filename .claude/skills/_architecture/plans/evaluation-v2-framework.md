# 评审 V2：高置信度鲁棒性评审框架

## 当前问题诊断

| 问题 | 影响 | 严重度 |
|------|------|--------|
| 主观打分 | 评审员偏好影响结果 | 高 |
| 单轮评审 | 无交叉验证 | 高 |
| 维度权重预设 | 假设权重合理性未验证 | 中 |
| 无对抗机制 | 可能遗漏关键缺陷 | 中 |
| 样本量不足 | 5个评审员统计显著性弱 | 中 |

---

## 改进方案

### 方案 A：量化指标替代主观评分

**原理**: 用可计数的客观指标替代 1-10 分主观评分

| 维度 | 原指标 | 改为量化指标 |
|------|--------|-------------|
| 架构合规性 | 主观 1-10 | L0/L1/L2 层级明确数量、与 registry 字段匹配率 |
| 原子化纯度 | 主观 1-10 | 单 Skill 平均依赖数、输入输出字段数、功能重叠检测 |
| 需求覆盖度 | 主观 1-10 | 8项用户需求的显式映射数（0/1 二值） |
| 实施可行性 | 主观 1-10 | 文件总数、依赖层级深度、外部 API 数量 |
| 可演进性 | 主观 1-10 | 扩展新 Skill 需修改文件数、向后兼容性检查点 |

**优点**: 可复现、无偏差
**缺点**: 部分维度难以完全量化

---

### 方案 B：多轮淘汰 + 对抗验证

**Round 1: 初筛（3个评审员）**
- 每个评审员独立淘汰 1 个最差方案
- 需 ≥2 票同意才淘汰
- 淘汰方案进入"复活池"

**Round 2: 深度对比（3个新评审员）**
- 仅对比剩余方案
- 必须列出每个方案的 Top 3 缺陷
- 缺陷严重度分级 (Critical/Major/Minor)

**Round 3: 对抗评审（1个Devil's Advocate）**
- 专门攻击"当前第一名"
- 寻找致命缺陷
- 若发现 Critical 缺陷，复活"复活池"中的方案重新评估

**Round 4: 共识投票（所有评审员）**
- 7 人投票，需 ≥5 票通过
- 若无共识，启动仲裁机制

**优点**: 高鲁棒性、对抗机制防止盲点
**缺点**: 评审轮次多、耗时长

---

### 方案 C：盲审 + 交叉验证

**盲审机制**:
- 去掉方案名称（Plan-A/B/C/D → 方案甲/乙/丙/丁，随机分配）
- 评审员不知道哪个是"自己写的"或"热门候选"

**交叉验证机制**:
- 每个方案由 3 个评审员独立评分
- 计算 Fleiss' Kappa 一致性系数
- Kappa < 0.6 的维度重新评审

**异常值处理**:
- 若某评审员的评分与其他 2 人偏差 > 2 分，标记为异常
- 异常评分需提供额外理由，否则剔除

**优点**: 减少偏见、提高一致性
**缺点**: 需要更多评审员

---

### 方案 D：层次分析法 (AHP) + 敏感性分析

**步骤 1: 构建成对比较矩阵**
- 评审员两两比较维度重要性（架构 vs 原子化，原子化 vs 覆盖度...）
- 计算特征向量得到权重

**步骤 2: 方案成对比较**
- 在每个维度下，两两比较方案（Plan-D vs Plan-A, Plan-D vs Plan-B...）
- 计算各方案在各维度的优先级

**步骤 3: 敏感性分析**
- 调整权重 ±20%，观察排名是否变化
- 若排名稳定，置信度高
- 若排名敏感，标记为"需谨慎决策"

**优点**: 数学严谨、敏感性可量化
**缺点**: 计算复杂、需要专门工具

---

### 方案 E：混合策略（推荐）

结合多种方法的优点：

```
┌─────────────────────────────────────────────────────────┐
│ Phase 1: 量化指标初筛                                    │
│ - 统计各方案的客观指标（文件数、依赖数、覆盖率）          │
│ - 淘汰明显不达标的方案（如文件数 > 100）                  │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 2: 盲审深度评分                                    │
│ - 打乱方案名称，3 个评审员独立评分                        │
│ - 计算 Kappa 一致性，不一致的维度重评                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 3: 对抗验证                                        │
│ - Devil's Advocate 攻击当前第一名                        │
│ - 列出 Critical/Major/Minor 缺陷清单                     │
│ - 若发现 Critical 缺陷，重新排名                         │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 4: 敏感性分析                                      │
│ - 权重 ±20% 变化下排名是否稳定                           │
│ - 输出置信区间和稳定性报告                               │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Phase 5: 最终共识                                        │
│ - 所有评审员投票                                         │
│ - 输出推荐方案 + 置信度等级 (High/Medium/Low)            │
└─────────────────────────────────────────────────────────┘
```

---

## 量化指标定义

### 1. 架构合规性指标

| 指标 | 计算方式 | 权重 |
|------|---------|------|
| L0/L1/L2 分层完整度 | 三层都有=1, 缺一层=0.5, 缺两层=0 | 30% |
| 命名规范匹配率 | 符合 TianGong 命名的 Skill 数 / 总数 | 25% |
| 契约等级覆盖 | 有 strict/standard/flexible 标注的 Skill 数 / 总数 | 25% |
| registry 字段完整度 | 包含 name/path/tier/domains/lineage 等字段的 Skill 数 / 总数 | 20% |

### 2. 原子化纯度指标

| 指标 | 计算方式 | 权重 |
|------|---------|------|
| 平均依赖数 | Σ(各 Skill 依赖的其他 Skill 数) / Skill 总数，越低越好 | 30% |
| 输入字段数 | Σ(各 Skill 输入 Schema 字段数) / Skill 总数，适中为佳 | 20% |
| 输出字段数 | Σ(各 Skill 输出 Schema 字段数) / Skill 总数，适中为佳 | 20% |
| 功能重叠检测 | 功能描述相似度 > 0.8 的 Skill 对数，越少越好 | 30% |

### 3. 需求覆盖度指标

| 用户需求 | 检测方式 | 分值 |
|---------|---------|------|
| 导师 Agent（类比解释） | 存在 analogy/explainer 相关 Skill | 0/1 |
| 苏格拉底 Agent（对抗提问） | 存在 socratic/questioner 相关 Skill | 0/1 |
| 策展 Agent（内容精选） | 存在 curator/scanner 相关 Skill | 0/1 |
| 空间记忆（可视化） | 存在 spatial/mapper/diagram 相关 Skill | 0/1 |
| 极速概览（技能树） | 存在 knowledge-graph/extractor 相关 Skill | 0/1 |
| 反向图灵测试 | 存在 self-explanation/validator 相关 Skill | 0/1 |
| 离线复盘 | 存在 offline/review 相关 Skill | 0/1 |
| 微项目驱动 | 存在 micro-project 相关 Skill | 0/1 |
| **总分** | 8项之和 | /8 |

### 4. 实施可行性指标

| 指标 | 计算方式 | 阈值 |
|------|---------|------|
| 文件总数 | SKILL.md + references + scripts | < 60 优, 60-80 良, > 80 差 |
| 依赖层级深度 | DAG 最长路径 | < 4 优, 4-6 良, > 6 差 |
| 外部 API 数量 | 需要调用的第三方 API | < 3 优, 3-5 良, > 5 差 |
| Phase 划分清晰度 | 是否有明确的分阶段交付 | 有=1, 无=0 |

### 5. 可演进性指标

| 指标 | 计算方式 | 权重 |
|------|---------|------|
| 扩展修改文件数 | 新增 1 个 Skill 需修改的文件数 | 40% |
| 契约稳定性 | 契约等级为 strict 的 Skill 占比 | 30% |
| 文档完整度 | 包含完整 SKILL.md 模板的方案 | 30% |

---

## 对抗验证清单

Devil's Advocate 必须回答的问题：

1. **致命缺陷**: 该方案是否存在使其完全无法工作的问题？
2. **隐藏成本**: 实施过程中可能出现哪些未预料的工作量？
3. **技术债务**: 该方案是否会引入难以偿还的技术债务？
4. **扩展瓶颈**: 当 Skill 数量增长到 50+ 时，该方案是否仍然可维护？
5. **外部依赖风险**: 若某个外部 API 不可用，影响范围有多大？
6. **测试盲区**: 该方案中哪些部分最难测试？
7. **团队能力匹配**: 该方案是否需要团队不具备的技能？

---

## 执行计划

若选择"方案 E：混合策略"，执行步骤：

```
Step 1: 量化指标计算 (1 个 Subagent)
- 自动统计各方案的客观指标
- 生成量化对比表

Step 2: 盲审评分 (3 个 Subagent 并行)
- 打乱方案名称
- 独立评分 + Kappa 一致性检验

Step 3: 对抗验证 (1 个 Devil's Advocate)
- 攻击当前排名第一的方案
- 列出缺陷清单

Step 4: 敏感性分析 (1 个 Subagent)
- 权重变化 ±20%
- 输出排名稳定性

Step 5: 汇总报告
- 综合所有 Phase 结果
- 输出最终推荐 + 置信度等级
```

预计需要 6-7 个 Subagent 轮次。
