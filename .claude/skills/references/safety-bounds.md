# RLAIF 安全边界

## 硬性约束（不可违反）

### 1. 修改幅度限制
- 单次迭代的 diff 行数不得超过原始 skill 总行数的 **30%**
- 单次迭代不得同时修改 SKILL.md 和超过 2 个 scripts/
- 不得删除 SKILL.md 的 frontmatter

### 2. 连续失败阈值
- 连续 **3 次** 修订被 reject → 冻结该 skill 的自动迭代
- 冻结后需要人工解冻或手动修改
- 冻结事件记录到 rlaif-log.jsonl，标记 severity=high

### 3. 核心 Skill 保护
- tier=core 的 skill 的任何修订必须人工确认
- 确认方式：生成修订报告，等待用户明确批准
- 未经确认的修订不得应用

### 4. 回滚能力
- 每次修订前自动保存版本快照到 state/genomes/
- 保留至少最近 **5** 个版本
- rollback.py 必须能在 1 步内恢复到任意已保存版本

### 5. 测试回退禁止
- 修订不得导致任何之前通过的测试用例变为失败
- 如果出现测试回退，修订自动 reject，无论其他指标如何

## 软性约束（可调整，但需要理由）

### 6. 进化频率
- 默认每 **10** 次任务执行后触发一次反馈循环
- 进化循环每 **50** 次任务执行后触发一次
- 可通过配置调整，但不得低于 5 次

### 7. 种群规模
- 同类 skill 的活跃变体不超过 **5** 个（避免选择困难）
- 总活跃 skill 数不超过 **50** 个（避免 registry 膨胀）
- 超出时触发 cull.py 淘汰

### 8. 新 Skill 孵化速率
- 每个进化周期最多创建 **3** 个新 skill
- 新 skill 必须在 sandbox 通过基础验证后才可注册
- 72 小时内未通过验证的 pending skill 自动废弃

## 紧急制动机制

如果检测到以下任何情况，立即停止所有自动迭代：

1. 某个 skill 的适应度突然下降超过 **0.3**
2. 出现未捕获的异常导致 skill 完全不可用
3. 连续 3 个不同 skill 的修订被 reject
4. state/ 目录的数据一致性校验失败

紧急制动后：
- 记录事件到 rlaif-log.jsonl，severity=critical
- 冻结所有自动迭代
- 生成诊断报告
- 等待人工介入
